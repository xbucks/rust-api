[package]
name = "rustapi"
version = "0.1.0"
authors = ["ndelvalle <nicolas.delvalle@gmail.com>"]
edition = "2018"

[dependencies]
config = "0.10"
rocket = "0.4.2"
serde = "1.0.101"
serde_derive = "1.0.101"
slog = "2.5.2"
slog-term = "2.4.2"
slog-async = "2.3.0"
failure = "0.1.6"
diesel = { version = "1.0.0", features = ["postgres"] }
r2d2 = "0.8.6"
r2d2-diesel = "1.0.0"
serde_json = "1.0.41"

[dependencies.rocket_contrib]
version = "0.4.2"
default-features = true
features = ["diesel_postgres_pool"]

[dev-dependencies.cargo-husky]
version = "1"
default-features = false
features = [
  "run-for-all",
  "prepush-hook",
  "precommit-hook",
  "run-cargo-check",
  "run-cargo-clippy",
  "run-cargo-fmt",
  "run-cargo-test",
]

# Cargo make tasks:
[tasks.format]
install_crate = "rustfmt"
command = "cargo"
args = ["fmt"]

[tasks.clean]
command = "cargo"
args = ["clean"]

[tasks.build]
command = "cargo"
args = ["build"]
dependencies = ["format"]

[tasks.test]
command = "cargo"
args = ["test"]
dependencies = ["clean"]

# cargo make --makefile ./cargo.toml ci
[tasks.ci]
dependencies = [
    "format",
    "build",
    "test"
]

# cargo make --makefile ./cargo.toml dev
[tasks.dev]
install_crate = "cargo-watch"
command = "cargo"
args = ["watch", "-x", "run"]

# cargo make --makefile ./cargo.toml migration-setup
[tasks.migration-setup]
install_crate = { crate_name = "diesel_cli", binary = "cargo", test_arg = ["--help"] }
install_crate_args = ["--no-default-features", "--features", "postgres"]
command = "diesel"
args = ["database", "setup"]

# cargo make --makefile ./cargo.toml migration-up
[tasks.migration-up]
install_crate = { crate_name = "diesel_cli", binary = "cargo", test_arg = ["--help"] }
install_crate_args = ["--no-default-features", "--features", "postgres"]
command = "diesel"
args = ["migration", "up"]
dependencies = ["migration-setup"]

# cargo make --makefile ./cargo.toml migration-down
[tasks.migration-down]
install_crate = { crate_name = "diesel_cli", binary = "cargo", test_arg = ["--help"] }
install_crate_args = ["--no-default-features", "--features", "postgres"]
command = "diesel"
args = ["migration", "revert"]

# cargo make --makefile ./cargo.toml migration-redo
[tasks.migration-redo]
install_crate = { crate_name = "diesel_cli", binary = "cargo", test_arg = ["--help"] }
install_crate_args = ["--no-default-features", "--features", "postgres"]
command = "diesel"
args = ["migration", "redo"]
